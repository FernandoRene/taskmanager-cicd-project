# =====================================================
# DOCKERFILE PARA BACKEND - TASKMANAGER
# =====================================================

# 1. ğŸ§± IMAGEN BASE - Como elegir el sistema operativo
FROM node:18-alpine

# Â¿Por quÃ© node:18-alpine?
# - node:18 = Viene con Node.js versiÃ³n 18 preinstalado
# - alpine = VersiÃ³n super ligera de Linux (5MB vs 100MB+)

# 2. ğŸ“ DIRECTORIO DE TRABAJO - Donde vivirÃ¡ tu app
WORKDIR /usr/src/app

# Es como hacer: cd /usr/src/app

# 3. ğŸ“‹ COPIAR ARCHIVOS DE DEPENDENCIAS PRIMERO
# Â¿Por quÃ© primero? Para aprovechar el cache de Docker
COPY package*.json ./

# Esto copia:
# - package.json
# - package-lock.json (si existe)

# 4. ğŸ“¦ INSTALAR DEPENDENCIAS
RUN npm ci --only=production

# npm ci vs npm install:
# - npm ci = MÃ¡s rÃ¡pido, para producciÃ³n
# - --only=production = No instala devDependencies

# 5. ğŸ“ COPIAR TODO EL CÃ“DIGO FUENTE
COPY . .

# El punto "." significa "todo en esta carpeta"

# 6. ğŸ‘¤ CREAR USUARIO NO-ROOT (Seguridad)
RUN addgroup -g 1001 -S nodejs
RUN adduser -S nodejs -u 1001
USER nodejs

# Â¿Por quÃ©? Por seguridad, no ejecutar como root

# 7. ğŸŒ EXPONER PUERTO
EXPOSE 3000

# No abre el puerto, solo lo "documenta"

# 8. âš¡ COMANDO DE INICIO
CMD ["npm", "start"]

# Es como ejecutar: npm start